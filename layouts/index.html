{{ define "main" }}
<div id="main-content" class="home" tabindex="-1">

  <!-- >>> START HERO SECTION -->
  <div class="hero-layout">
    <section
      class="hero has-hero-bg"
      data-bg="{{ ("images/bg_image.webp" | absURL) }}?v={{ with site.Params.appVer }}{{ . }}{{ end }}"
      aria-label="Hero EventHorizon.mtg"
    >
      <div class="hero__inner">
        <div class="hero__content">
          <!-- >>> START HERO LOGO (responsive with srcset) -->
          <img class="hero__logo"
                src="{{ ("images/logo.webp" | absURL) }}?v={{ with site.Params.appVer }}{{ . }}{{ end }}"
                srcset="{{ ("images/logo.webp" | absURL) }}?v={{ with site.Params.appVer }}{{ . }}{{ end }} 1x,
                        {{ ("images/logo.webp" | absURL) }}?v={{ with site.Params.appVer }}{{ . }}{{ end }} 2x"
                alt="Logo {{ .Site.Title }}"
                width="140" height="140"
                decoding="async"
                fetchpriority="high" />
          <!-- <<< END HERO LOGO -->

          <!-- Text hero -->
          <h1 class="hero__title">BEYOND THE HORIZON</h1>
          <p class="hero__subtitle">
            Narrativa e mazzi Commander.
            <br>Tutto su un'unica rotta!
          </p>
          <div class="hero__actions">
            <a class="btn btn--special" href="{{ "/archive/" | absURL }}">Esplora l'Archivio</a>
            <a class="btn btn--mox-glass" href="https://moxfield.com/users/EventHorizonMtG" target="_blank" rel="noopener noreferrer">Le nostre Decklist</a>
          </div>
          
          <!-- Scroll indicator -->
          <div class="hero__scroll-hint" aria-hidden="true">
            <svg class="hero__scroll-icon" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
        </div>
      </div>

    </section>
  </div>
  <!-- <<< END HERO -->

    <!-- >>> START CARDS SECTION -->
  <section id="cards" class="cards cards--stack cards--panels" aria-labelledby="cards-title">
    <div class="cards__inner">
      <header class="cards__header">
        <div class="cards__intro">
          <span class="cards__eyebrow">Dal Logbook</span>
          <h2 id="cards-title" class="cards__title">Ultimi contenuti</h2>
        </div>
      </header>

      <div class="cards__stack">
        {{/* Ultime 4 dal data archive: data/archive/items/*.yml */}}
        {{ $items := slice }}
        {{ with .Site.Data.archive.items }}
          {{ range $k, $v := . }}
            {{ if not $v.draft }}{{ $items = $items | append $v }}{{ end }}
          {{ end }}
        {{ end }}
        {{ $items = sort $items "date" "desc" }}
        {{ $items = first (cond (gt (len $items) 4) 4 (len $items)) $items }}

        {{ if gt (len $items) 0 }}
          {{ range $i, $it := $items }}
            {{ $kindRaw := cond (isset $it "kind") (lower $it.kind) "content" }}
            {{ $kind := cond (gt (len $kindRaw) 0) $kindRaw "content" }}
            {{ $isVideo := eq $kind "video" }}
            {{ $thumbURL := ("images/cards/fblthp_placeholder.webp" | absURL) }}
            {{ with $it.card }}
              {{ $c := . }}
              {{ $thumbURL = partial "url-to-abs.html" $c }}
            {{ else }}
              {{ with $it.thumb }}
                {{ $t := . }}
                {{ $thumbURL = partial "url-to-abs.html" $t }}
              {{ end }}
            {{ end }}
            {{ $links := cond (isset $it "links") (sort $it.links "sort_order" "asc") (slice) }}
            {{ $primaryLinks := where $links "primary" true }}
            {{ $primaryLinkData := dict }}
            {{ if gt (len $primaryLinks) 0 }}
              {{ $primaryLinkData = index $primaryLinks 0 }}
            {{ else if gt (len $links) 0 }}
              {{ $primaryLinkData = index $links 0 }}
            {{ end }}
            {{ $primaryLink := "" }}
            {{ $primaryLabel := "" }}
            {{ $primaryClass := "" }}
            {{ if gt (len $primaryLinkData) 0 }}
              {{ with $primaryLinkData.href }}{{ $primaryLink = . }}{{ end }}
              {{ with $primaryLinkData.label }}{{ $primaryLabel = . }}{{ end }}
              {{ if isset $primaryLinkData "btn_class" }}
                {{ $primaryClass = trim $primaryLinkData.btn_class " " }}
              {{ end }}
            {{ end }}
            {{ $hasPrimary := ne $primaryLink "" }}
            {{ $ctaHref := cond $hasPrimary $primaryLink ("/archive/" | absURL) }}
            {{ $ctaExternal := and $hasPrimary (hasPrefix $primaryLink "http") }}
            {{ $playHref := cond (and $isVideo $hasPrimary) $primaryLink "" }}
            {{ $playExternal := and (ne $playHref "") (hasPrefix $playHref "http") }}
            {{ $ctaLabel := "" }}
            {{ if $hasPrimary }}
              {{ $ctaLabel = cond (gt (len $primaryLabel) 0) $primaryLabel (cond $isVideo "Guarda" "Vai al contenuto") }}
            {{ else }}
              {{ $ctaLabel = "Altro" }}
            {{ end }}
            {{ $hasSecondary := false }}
            {{ range $links }}
              {{ $href := .href }}
              {{ if and $href (not .primary) }}
                {{ $hasSecondary = true }}
              {{ end }}
            {{ end }}
            {{ $bgImageURL := "" }}
            {{ with $it.background_image }}
              {{ $bg := . }}
              {{ $bgImageURL = partial "url-to-abs.html" $bg }}
            {{ end }}
            {{/* Fallback: se non c'è background_image usa la thumb come sfondo */}}
            {{ if eq $bgImageURL "" }}
              {{ $bgImageURL = $thumbURL }}
            {{ end }}
            <article class="card card--stack-item card--{{ $kind }} {{ if $isVideo }}is-video{{ else }}is-content{{ end }}{{ if $bgImageURL }} has-bg-image{{ end }}" {{ if $bgImageURL }}data-bg-url="{{ $bgImageURL }}"{{ end }}>
              <header class="card__header">
                <span class="card__overline">{{ with $it.overline }}{{ . }}{{ else }}&nbsp;{{ end }}</span>
                <h3 class="card__title">{{ $it.title }}</h3>
              </header>

              <figure class="card__media">
                <img
                  class="card__img"
                  src="{{ $thumbURL }}"
                  width="1280" height="720"
                  alt="{{ if $it.title }}{{ $it.title }}{{ else }}Immagine contenuto{{ end }}"
                  loading="{{ if eq $i 0 }}eager{{ else }}lazy{{ end }}"
                  fetchpriority="{{ if eq $i 0 }}high{{ else }}low{{ end }}"
                  decoding="async" />
                {{ if $playHref }}
                  <span class="card__media-overlay" aria-hidden="true"></span>
                  {{ $playClasses := "card__play" }}
                  {{ if $primaryClass }}
                    {{ $playClasses = printf "%s %s" $playClasses $primaryClass }}
                  {{ end }}
                  <a class="{{ $playClasses }}"
                     href="{{ $playHref }}"
                     {{ if $playExternal }}target="_blank" rel="noopener noreferrer"{{ end }}
                     aria-label="{{ if gt (len $primaryLabel) 0 }}{{ $primaryLabel }}{{ else }}Guarda video: {{ $it.title }}{{ end }}">
                    <svg class="card__play-icon" viewBox="0 0 68 48" aria-hidden="true" focusable="false">
                      <path class="card__play-shape" d="M66.52 7.85a8.06 8.06 0 00-5.68-5.68C55.16 0 34 0 34 0S12.84 0 7.16 2.17a8.06 8.06 0 00-5.68 5.68A83.5 83.5 0 000 24a83.5 83.5 0 001.48 16.15 8.06 8.06 0 005.68 5.68C12.84 48 34 48 34 48s21.16 0 27.84-2.17a8.06 8.06 0 005.68-5.68A83.5 83.5 0 0068 24a83.5 83.5 0 00-1.48-16.15z" />
                      <polygon class="card__play-symbol" points="27,14 45,24 27,34" />
                    </svg>
                  </a>
                {{ else if and (not $isVideo) $hasPrimary }}
                  <span class="card__media-overlay" aria-hidden="true"></span>
                  {{/* For content cards, force primary-glass button style as centered overlay */}}
                  {{ $ctaPlayClasses := "card__play btn btn--primary-glass" }}
                  <a class="{{ $ctaPlayClasses }}"
                     href="{{ $ctaHref }}"
                     {{ if $ctaExternal }}target="_blank" rel="noopener noreferrer"{{ end }}
                     aria-label="{{ if gt (len $primaryLabel) 0 }}{{ $primaryLabel }}{{ else }}Apri: {{ $it.title }}{{ end }}">
                    <span>{{ $ctaLabel }}</span>
                  </a>
                {{ end }}
              </figure>

              <div class="card__body">
                <div class="card__desc">{{ with $it.desc }}{{ . | markdownify }}{{ else }}&nbsp;{{ end }}</div>
                {{ if isset $it "content" }}
                  {{ if $it.content }}
                    <div class="card__content">{{ $it.content | markdownify }}</div>
                  {{ end }}
                {{ end }}
                {{ if $hasSecondary }}
                  <div class="card__actions">
                    {{ range $links }}
                      {{ $href := .href }}
                      {{ if and $href (not .primary) }}
                        {{ $secondaryExternal := hasPrefix $href "http" }}
                        {{ $secondaryClasses := "card__btn" }}
                        {{ if isset . "btn_class" }}
                          {{ $secondaryClassValue := trim .btn_class " " }}
                          {{ if ne $secondaryClassValue "" }}
                            {{ $secondaryClasses = printf "%s %s %s" $secondaryClasses "pill" $secondaryClassValue }}
                          {{ end }}
                        {{ end }}
                        <a class="{{ $secondaryClasses }}" href="{{ $href }}"{{ if $secondaryExternal }} target="_blank" rel="noopener noreferrer"{{ end }}>
                          {{ .label | default "Apri" }}
                        </a>
                      {{ end }}
                    {{ end }}
                  </div>
                {{ end }}
                {{ if not $hasPrimary }}
                  <div class="card__cta-row">
                    {{ $ctaClasses := "card__cta" }}
                    {{ if $primaryClass }}
                      {{ $ctaClasses = printf "%s %s %s" $ctaClasses "pill" $primaryClass }}
                    {{ end }}
                    <a class="{{ $ctaClasses }}" href="{{ $ctaHref }}"{{ if $ctaExternal }} target="_blank" rel="noopener noreferrer"{{ end }}>
                      <span>{{ $ctaLabel }}</span>
                    </a>
                  </div>
                {{ end }}
              </div>
            </article>
          {{ end }}
        {{ else }}
          <article class="card card--stack-item card--content">
            <header class="card__header">
              <span class="card__overline">Logbook</span>
              <h3 class="card__title">Nessun contenuto</h3>
            </header>
            <figure class="card__media">
              <img class="card__img" src="{{ "images/cards/fblthp_placeholder.webp" | absURL }}" width="1280" height="720" alt="" />
            </figure>
            <div class="card__body">
              <p class="card__desc">Contenuti in arrivo.</p>
              <div class="card__cta-row">
                <a class="card__cta" href="{{ "/archive/" | absURL }}">
                  <span>Visita l'archivio</span>
                </a>
              </div>
            </div>
          </article>
        {{ end }}
      </div>
    </div>
  </section>
  <!-- <<< END CARDS SECTION -->

  <!-- >>> START LINKS -->
  <section class="links" aria-labelledby="links-title">
    <div class="links__inner">
      <h2 id="links-title" class="links__title">Amici, Partners &amp; Links</h2>

      <div class="links__carousel">
        <ul class="links__track" role="list">
          {{/* Carica tutti i link da data/links/*.yml e ordina per sort_order */}}
          {{ $links := slice }}
          {{ with .Site.Data.links }}
            {{ range $k, $v := . }}
              {{ $links = $links | append $v }}
            {{ end }}
          {{ end }}
          {{ $links = sort $links "sort_order" "asc" }}

          {{ range $links }}
            {{ $logoURL := .logo }}
            {{ if not (hasPrefix $logoURL "http") }}
              {{ $logoURL = ($logoURL | absURL) }}
            {{ end }}
            {{ $isLogoOnly := cond (isset . "logo_only") .logo_only false }}

            <li class="link-card{{ if $isLogoOnly }} link-card--logo-only{{ end }}" data-category="{{ .category }}">
              <a class="link-card__link" href="{{ .url }}" target="_blank" rel="noopener noreferrer" aria-label="{{ .name }}">
                {{ if $isLogoOnly }}
                  <img class="link-card__logo" src="{{ $logoURL }}?v={{ with site.Params.appVer }}{{ . }}{{ end }}" alt="{{ .name }}" width="160" height="56" loading="lazy" decoding="async">
                {{ else }}
                  <img class="link-card__logo" src="{{ $logoURL }}?v={{ with site.Params.appVer }}{{ . }}{{ end }}" alt="{{ .name }}" width="64" height="64" loading="lazy" decoding="async">
                  <div class="link-card__meta">
                    <span class="link-card__name">{{ .name }}</span>
                    {{ with .description }}<span class="link-card__copy">{{ . }}</span>{{ end }}
                  </div>
                {{ end }}
              </a>
            </li>
          {{ end }}

        </ul>
      </div>
    </div>
  </section>
  <!-- <<< END LINKS -->

  <!-- >>> START CONTACTS -->
  <section id="contacts" class="contacts" aria-labelledby="contacts-title">
  <div class="contacts__inner">
    <div class="contacts__grid">
      <div class="contacts__copy">
        <h2 id="contacts-title" class="contacts__title">Chi siamo</h2>
        <p class="contacts__intro">
          Siamo Vincenzo e Francesco, amici appassionati di Magic: The Gathering, Dungeons & Dragons, giochi da tavolo e videogiochi.
        </p>
        <p class="contacts__sub">Restiamo in contatto</p>
      </div>

      <div class="contacts__actions">
        {{/* Carica tutti i contatti da data/contacts/*.yml e ordina per sort_order */}}
        {{ $contacts := slice }}
        {{ with .Site.Data.contacts }}
          {{ range $k, $v := . }}
            {{ $contacts = $contacts | append $v }}
          {{ end }}
        {{ end }}
        {{ $contacts = sort $contacts "sort_order" "asc" }}

        {{/* Separa contatti normali da quelli speciali (email) */}}
        {{ $normalContacts := where $contacts "is_special" "!=" true }}
        {{ $specialContacts := where $contacts "is_special" true }}

        <ul class="contacts__list" role="list">
          {{ range $normalContacts }}
            {{ $isExternal := hasPrefix .url "http" }}
            <li>
              <a class="contact" href="{{ .url }}"{{ if $isExternal }} target="_blank" rel="noopener noreferrer"{{ end }} aria-label="{{ .name }}" title="{{ .name }}">
                <span class="contact__icon {{ .icon_class }}" aria-hidden="true"></span>
              </a>
            </li>
          {{ end }}
        </ul>
        {{ range $specialContacts }}
          {{ $isExternal := hasPrefix .url "http" }}
          <a class="contact contact--mail" href="{{ .url }}"{{ if $isExternal }} target="_blank" rel="noopener noreferrer"{{ end }} aria-label="{{ .name }}" title="{{ .name }}">
            <span class="contact__icon {{ .icon_class }}" aria-hidden="true"></span>
          </a>
        {{ end }}
      </div>
    </div>
  </div>
  </section>
  <!-- <<< END CONTACTS -->


</div>
{{ end }}





