{{/* layouts/partials/scripts.html
     Bundle JS via Hugo Pipes (robusto ai file mancanti)
          Ordine preservato: script.js -> links.js -> archive.js
     Sorgenti attesi in: /assets/scripts/
*/}}

{{- $jsPaths := slice
    "scripts/script.js"
    "scripts/links.js"
    "scripts/cards-carousel.js"
    "scripts/archive.js"
    "scripts/privacy.js"
-}}

{{- /* Costruzione lista parts con Scratch per evitare problemi di scope */ -}}
{{- $.Scratch.Set "jsParts" (slice) -}}
{{- range $p := $jsPaths -}}
  {{- with resources.Get $p -}}
    {{- $.Scratch.Add "jsParts" (slice .) -}}
  {{- else -}}
    {{- /* File mancante: non interrompere la build */ -}}
    {{- warnf "scripts.html: risorsa JS non trovata: %s" $p -}}
  {{- end -}}
{{- end -}}
{{- $parts := $.Scratch.Get "jsParts" -}}

{{- if gt (len $parts) 0 -}}
  {{- $bundle := ($parts | resources.Concat "script/bundle.js") | resources.Minify | resources.Fingerprint -}}
  <script defer src="{{ $bundle.RelPermalink }}" integrity="{{ $bundle.Data.Integrity }}" crossorigin="anonymous"></script>
{{- else -}}
  {{- /* Nessun JS disponibile: niente output */ -}}
{{- end -}}
<!-- >>> START: load archive.js solo su /archive/ -->
{{ if eq .Section "archive" }}
  <script>
    (function () {
      var base = document.documentElement.getAttribute('data-base-url') || '';
      if (!base) {
        base = window.location.origin;
      }
      var normalized = base.replace(/\/$/, '');
      window.__ARCHIVE_ENDPOINT__ = normalized + '/archive/list.json';
    })();
  </script>
{{ end }}
<!-- <<< END: load archive.js solo su /archive/ -->



