/* ==========================================
   CARDS SECTION - Vertical Spacing Optimized
   Padding verticale bilanciato per respiro tra sezioni
   ========================================== */

.cards {
  /* Padding verticale responsivo per sezione contenuti */
  padding-block: var(--space-6) var(--space-8);
  padding-inline: clamp(16px, var(--container-padding), var(--container-padding));
}

/* Mobile: riduci padding per massimizzare contenuto */
@media (max-width: 47.999rem) {
  .cards {
    padding-block: var(--space-5) var(--space-6);
    padding-inline: 8px;
  }
}

/* Desktop large: aumenta respiro */
@media (min-width: 80rem) {
  .cards {
    padding-block: var(--space-8) var(--space-10);
  }
}

.cards__inner {
  max-width: var(--container-max);
  margin-inline: auto;
  padding-inline: var(--container-padding);
  display: grid;
  gap: var(--space-4);
}

@media (max-width: 47.999rem) {
  .cards__inner {
    padding-inline: 8px;
    gap: var(--space-3);
  }
}

.cards__header {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  align-items: flex-start;
}

.cards__title {
  font-size: var(--text-2xl);
  text-transform: uppercase;
  letter-spacing: var(--tracking-widest);
}

.cards__view-all {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2);
  font-family: var(--font-display);
  font-size: var(--text-xs);
  letter-spacing: var(--tracking-widest);
  text-transform: uppercase;
  color: var(--color-primary);
}

.cards__view-all::after {
  content: "â†’";
  transform: translateX(0);
  transition: transform var(--transition-fast);
}

.cards__view-all:hover::after,
.cards__view-all:focus-visible::after {
  transform: translateX(4px);
}

.cards__grid {
  display: grid;
  gap: var(--space-4);
}

@media (min-width: 48rem) {
  .cards__header {
    flex-direction: row;
    justify-content: space-between;
    align-items: baseline;
  }

  .cards__grid {
    grid-template-columns: repeat(auto-fit, minmax(18.5rem, 1fr));
  }
}

.card {
  position: relative;
  display: flex;
  flex-direction: column;
  min-height: 100%;
  border-radius: var(--radius-xl);
  border: 1px solid var(--color-border-soft);
  background: var(--color-surface-glass);
  box-shadow: var(--shadow-soft);
  overflow: hidden;
  transition: transform var(--transition-base), border-color var(--transition-fast), box-shadow var(--transition-base);
}

/* Background image via data attribute (CSP-safe alternative to inline styles) */
.card.has-bg-image[data-bg-url] {
  background-image: var(--card-bg-image);
  background-size: cover;
  background-position: center;
}

/* ==========================================================
   CARDS SLIDER (carousel-like) â€” homepage specific
   ========================================================== */

.cards--slider .cards__viewport {
  position: relative;
  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x mandatory;
}

.cards--slider .cards__track {
  display: flex;
  gap: var(--space-4);
  padding-inline: clamp(1rem, 8vw, 5rem);
}

.cards--slider .cards__track > .slide {
  /* slide base sizing */
  flex: 0 0 clamp(18rem, 60vw, 24rem);
  scroll-snap-align: center;
  transform-origin: center bottom;
  /* compositing via CSS vars so hover/active can combine */
  --slide-scale: 0.92;
  --slide-ty: 0px;
  transform: translateY(var(--slide-ty)) scale(var(--slide-scale));
  transition: transform var(--transition-slow),
              box-shadow var(--transition-base),
              opacity var(--transition-fast);
  opacity: 0.78;
}

.cards--slider .cards__track > .slide.is-active {
  --slide-scale: 1;
  opacity: 1;
  z-index: 2;
  box-shadow: var(--shadow-elevated);
}

.cards--slider .cards__track > .slide.is-prev,
.cards--slider .cards__track > .slide.is-next {
  --slide-scale: 0.96;
  opacity: 0.9;
  z-index: 1;
}

.cards--slider .cards__track > .slide:hover {
  --slide-ty: -4px;
}

@media (min-width: 64rem) {
  .cards--slider .cards__track {
    gap: var(--space-5);
  }
  .cards--slider .cards__track > .slide {
    flex-basis: clamp(20rem, 40vw, 26rem);
  }
}

.cards--slider .cards__controls {
  margin-top: var(--space-3);
  display: flex;
  justify-content: center;
  gap: var(--space-2);
}

/* Mobile: avvicinare i dots alle cards con margin negativo */
@media (max-width: 47.999rem) {
  .cards--slider .cards__controls {
    margin-top: calc(var(--space-3) * 0);
    padding-top: 0;
  }
}

.cards--slider .cards__nav {
  display: inline-grid;
  place-items: center;
  width: 2.25rem;
  height: 2.25rem;
  border-radius: var(--radius-full);
  border: 1px solid var(--color-border-soft);
  background: var(--color-surface-glass);
  color: var(--color-text);
  line-height: 1;
  transition: var(--transition-all);
}
.cards--slider .cards__nav:hover,
.cards--slider .cards__nav:focus-visible {
  border-color: var(--color-border);
  box-shadow: var(--shadow-focus);
}

.cards--slider .cards__details {
  margin-top: var(--space-4);
  display: grid;
  gap: var(--space-2);
  text-align: center;
}
.cards--slider .cards__details-over {
  font-family: var(--font-display);
  font-size: var(--text-xs);
  letter-spacing: var(--tracking-widest);
  text-transform: uppercase;
  color: var(--color-special);
}
.cards--slider .cards__details-title {
  font-size: var(--text-xl);
}
.cards--slider .cards__details-desc {
  color: var(--color-text-muted);
}

@media (prefers-reduced-motion: reduce) {
  .cards--slider .cards__track > .slide {
    transition: none;
  }
}

.card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(125, 211, 252, 0.16) 0%, rgba(125, 211, 252, 0.02) 45%, transparent 100%);
  opacity: 0;
  transition: opacity var(--transition-fast);
  pointer-events: none;
}

.card:hover,
.card:focus-within {
  border-color: var(--color-border);
  box-shadow: var(--shadow-elevated);
}

.card:hover::before,
.card:focus-within::before {
  opacity: 1;
}

@media (hover: hover) and (pointer: fine) and (min-width: 75rem) {
  .card:hover,
  .card:focus-within {
    transform: translateY(-6px);
  }
}

.card__media {
  position: relative;
  overflow: hidden;
  aspect-ratio: 16 / 9;
  background: var(--color-surface-elevated);
}

.card__img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform var(--transition-slow);
}

.card:hover .card__img {
  transform: scale(1.05);
}

.card__media-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(7, 14, 26, 0) 35%, rgba(7, 14, 26, 0.9) 100%);
  opacity: 0;
  transition: opacity var(--transition-fast);
}

.card:hover .card__media-overlay,
.card.is-video .card__media-overlay {
  opacity: 1;
}

.card__play {
  position: absolute;
  inset: auto auto var(--space-4) var(--space-4);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: clamp(0.35rem, 2vw, 0.6rem);
  border-radius: var(--radius-full);
  background: transparent;
  box-shadow: 0 18px 38px rgba(0, 0, 0, 0.35);
  z-index: 4;
  pointer-events: auto;
  transform-origin: center;
  visibility: visible;
  opacity: 1;
  -webkit-tap-highlight-color: transparent;
  transition:
    transform var(--transition-fast),
    box-shadow var(--transition-fast),
    filter var(--transition-fast),
    opacity var(--transition-fast);
}

/* When used as a real button (btn variant), re-apply button visuals */
.card__play.btn {
  background: var(--btn-bg);
  color: var(--btn-color);
  border: 1px solid var(--btn-border);
  box-shadow: var(--btn-shadow);
  padding: var(--space-2) var(--space-4);
}

/* Make the overlay CTA larger on content cards */
#cards.cards--stack.cards--panels .card.is-content .card__play.btn {
  font-size: clamp(0.9rem, 1.6vw, 1.05rem);
  padding: clamp(0.6rem, 1.5vw, 0.9rem) clamp(1.1rem, 2.4vw, 1.5rem);
  border-radius: var(--radius-full);
}

/* Variant used for primary CTA on content cards positioned like the play button */
.card__play--cta {
  background: var(--color-surface-glass);
  border: 1px solid var(--color-border-soft);
  color: var(--color-text);
  padding: 0.45rem 0.75rem;
  border-radius: var(--radius-full);
  font-family: var(--font-display);
  font-size: var(--text-xs);
  letter-spacing: var(--tracking-widest);
  text-transform: uppercase;
  text-decoration: none;
  box-shadow: var(--shadow-sm);
}

.card__play--cta:hover,
.card__play--cta:focus-visible {
  background: var(--color-surface-hover);
  border-color: var(--color-border);
}

.card__play:focus-visible {
  outline: 3px solid rgba(255, 255, 255, 0.65);
  outline-offset: 4px;
}

.card__play:hover,
.card__play:focus-visible {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 22px 44px rgba(0, 0, 0, 0.45);
  filter: brightness(1.05);
}

.card__play-icon {
  width: clamp(3.5rem, 18vw, 4.5rem);
  height: auto;
  display: block;
}

.card__play-shape {
  fill: #ff1f1f;
}

.card__play-symbol {
  fill: var(--color-white);
}

.card__play:hover .card__play-shape,
.card__play:focus-visible .card__play-shape {
  fill: #ff4d4d;
}

@media (max-width: 1023px) {
  #cards.cards--stack.cards--panels .card__play {
    /* Center the play/CTA button on mobile/tablet */
    top: 50%;
    left: 50%;
    right: auto;
    bottom: auto;
    transform: translate(-50%, -50%);
    padding: clamp(0.4rem, 2.5vw, 0.6rem);
    display: inline-flex;
    justify-content: center;
    align-items: center;
    box-shadow: none;
    box-sizing: border-box;
  }

  #cards.cards--stack.cards--panels .card__play:focus-visible {
    outline-width: 2px;
    outline-offset: 6px;
  }

  #cards.cards--stack.cards--panels .card__play:hover {
    /* No hover effects on mobile/tablet */
    transform: translate(-50%, -50%);
    box-shadow: none;
    filter: none;
  }

  #cards.cards--stack.cards--panels .card__play:focus-visible {
    transform: translate(-50%, -50%) scale(1.05);
    box-shadow: none;
    filter: brightness(1.05);
  }

  #cards.cards--stack.cards--panels .card.is-video .card__media { cursor: default; }
}

@media (min-width: 1024px) {
  #cards.cards--stack.cards--panels .card__play {
    top: 50%;
    left: 50%;
    right: auto;
    bottom: auto;
    transform: translate(-50%, -50%);
    padding: clamp(0.5rem, 1.5vw, 0.75rem);
    box-shadow: 0 20px 45px rgba(0, 0, 0, 0.5);
  }

  #cards.cards--stack.cards--panels .card__play:hover,
  #cards.cards--stack.cards--panels .card__play:focus-visible {
    transform: translate(-50%, -50%) scale(1.08);
  }

  #cards.cards--stack.cards--panels .card:not(.is-expanded) .card__play {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }
}

  .card__body {
    display: grid;
    gap: var(--space-2);
    padding: var(--space-3);
  }

.card__overline {
  font-family: var(--font-display);
  font-size: var(--text-xs);
  letter-spacing: var(--tracking-widest);
  text-transform: uppercase;
  color: var(--color-special);
}

.card__title {
  font-size: var(--text-lg);
  line-height: var(--leading-snug);
  color: var(--color-text);
}

  .card__desc {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    line-height: 1.8;
  }

/* Desktop-only: do not show pointer in non-action areas; allow pointer only on real controls */
@media (min-width: 1024px) {
  /* Remove hand cursor from the whole card by default in panels layout */
  #cards.cards--stack.cards--panels .card {
    cursor: default;
  }

  #cards.cards--stack.cards--panels .card__body,
  #cards.cards--stack.cards--panels .card__desc,
  #cards.cards--stack.cards--panels .card__content,
  #cards.cards--stack.cards--panels .card__media,
  #cards.cards--stack.cards--panels .card__header,
  #cards.cards--stack.cards--panels .card__title,
  #cards.cards--stack.cards--panels .card__overline {
    cursor: default;
  }

  #cards.cards--stack.cards--panels .card__body a,
  #cards.cards--stack.cards--panels .card__body button,
  #cards.cards--stack.cards--panels .card__content a,
  #cards.cards--stack.cards--panels .card__content button,
  #cards.cards--stack.cards--panels .card__cta,
  #cards.cards--stack.cards--panels .card__btn,
  #cards.cards--stack.cards--panels .card__play {
    cursor: pointer;
  }

  /* When a card is collapsed (not expanded), show pointer to indicate it is clickable */
  #cards.cards--stack.cards--panels .card:not(.is-expanded) {
    cursor: pointer;
  }
  #cards.cards--stack.cards--panels .card:not(.is-expanded) .card__media,
  #cards.cards--stack.cards--panels .card:not(.is-expanded) .card__header,
  #cards.cards--stack.cards--panels .card:not(.is-expanded) .card__title,
  #cards.cards--stack.cards--panels .card:not(.is-expanded) .card__overline {
    cursor: pointer;
  }
}

/* Desktop: make description tighter to free space for extended content */
@media (min-width: 1024px) {
  #cards.cards--stack.cards--panels .card__body {
    gap: var(--space-2);
  }

  #cards.cards--stack.cards--panels .card__desc {
    margin: 0;
    line-height: 1.55;
    min-height: auto;
    flex: 0 0 auto; /* do not stretch: height equals text content */
  }
  #cards.cards--stack.cards--panels .card__desc > :last-child {
    margin-bottom: 0;
  }
}

.card__desc--primary {
  color: var(--color-primary);
  font-weight: 500;
}

.card__desc--accent {
  color: var(--color-accent);
  font-weight: 500;
}

.card__desc--centered {
  text-align: center;
}

.card__actions {
  margin-top: auto;
  padding: 0 var(--space-4) var(--space-4);
}

.card--featured {
  grid-column: 1 / -1;
  display: grid;
}

.card--featured .card__media {
  aspect-ratio: 20 / 9;
}

/* Normalize featured variant inside slider */
.cards--slider .card--featured {
  display: block;
}
.cards--slider .card--featured .card__media {
  aspect-ratio: 16 / 9;
}

/* ==========================================================
   PANELS VARIANT â€” expanding columns with overlay preview
   ========================================================== */

.cards--slider.cards--panels .cards__track {
  align-items: stretch;
}

.cards--slider.cards--panels .cards__track > .slide {
  /* collapsed column width */
  flex: 0 0 clamp(10rem, 22vw, 14rem);
  opacity: 0.95;
  transform: none;
}

.cards--slider.cards--panels .cards__track > .slide.is-active {
  opacity: 1;
}

.cards--slider.cards--panels .cards__track > .slide.is-expanded {
  /* expanded fills the viewport width */
  flex: 1 0 100%;
}

.cards--panels .card {
  border: 0;
  background: transparent;
  box-shadow: none;
}

.cards--panels .card::before,
.cards--panels .card:hover::before,
.cards--panels .card:focus-within::before {
  display: none;
}

.cards--panels .card:hover,
.cards--panels .card:focus-within {
  transform: none;
  box-shadow: none;
}

.cards--panels .card__media {
  aspect-ratio: 3 / 4;
}

.cards--panels .slide.is-expanded .card__media,
.cards--panels .card.is-expanded .card__media {
  aspect-ratio: 16 / 9;
}

/* Tablet: rimosso il layout intermedio problematico -
   il comportamento carousel mobile si estende fino a 1024px
   per mantenere aspect-ratio 16/9 corretto */

/* overlay readability in collapsed state */
.cards--panels .card__media::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(0,0,0,0) 40%, rgba(0,0,0,0.55) 100%);
  pointer-events: none;
  opacity: 1;
  transition: opacity var(--transition-base);
}

.cards--panels .slide.is-expanded .card__media::after,
.cards--panels .card.is-expanded .card__media::after {
  opacity: 0.35;
}

/* body as overlay in collapsed; structured in expanded */
.cards--panels .card__body {
  position: absolute;
  inset: auto 0 0 0;
  padding: var(--space-4);
  display: grid;
  gap: var(--space-2);
}

.cards--panels .slide.is-expanded .card__body,
.cards--panels .card.is-expanded .card__body {
  position: static;
  padding: var(--space-5);
  background: var(--color-surface-glass);
  border-top: 1px solid var(--color-border-soft);
  border-radius: 0 0 var(--radius-xl) var(--radius-xl);
}

.cards--panels .card__desc,
.cards--panels .card__actions {
  display: none;
}

.cards--panels .slide.is-expanded .card__desc,
.cards--panels .card.is-expanded .card__desc {
  display: block;
}

.cards--panels .slide.is-expanded .card__actions,
.cards--panels .card.is-expanded .card__actions {
  display: flex;
}
/* Ensure actions remain visible in collapsed state when placed inside the body */
.cards--panels .card__body .card__actions {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
}

.cards--panels .card__title {
  color: var(--color-white);
  text-shadow: var(--shadow-sm);
}

.cards--panels .slide.is-expanded .card__title,
.cards--panels .card.is-expanded .card__title {
  color: var(--color-text);
  text-shadow: none;
}

.cards--panels .card__overline {
  color: var(--color-special);
}

.card--empty {
  align-items: center;
  text-align: center;
  padding-block: var(--space-6);
}

@media (min-width: 64rem) {
  .card--featured {
    grid-template-columns: 1.6fr 1fr;
  }

  .card--featured .card__body {
    padding: var(--space-5);
  }
}
/* ========================================================================== 
   Cards Stack Variant
   ========================================================================== */

.cards--stack {
  --stack-gap: clamp(12px, 2vw, 18px);
  --card-radius: calc(var(--radius-xl, 18px) - 6px);
  --card-border: color-mix(in srgb, var(--color-border-soft) 80%, transparent);
  --card-bg: color-mix(in srgb, var(--color-surface-elevated, #111421) 85%, transparent 15%);
  --card-padding: clamp(14px, 2vw, 18px);
  --media-ratio: 3 / 4;
  /* Altezza esplicita della sezione per ancorare le card */
  height: clamp(700px, 75vh, 1000px);
  overflow: hidden;
}

.cards--stack .cards__inner {
  display: grid;
  gap: var(--stack-gap);
  /* Header + stack che occupa lo spazio rimanente */
  grid-template-rows: auto 1fr;
  height: 100%;
}

.cards--stack .cards__header {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.cards--stack .cards__intro {
  display: grid;
  gap: 0.35rem;
}

.cards--stack .cards__eyebrow {
  font-size: 0.85rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.cards--stack .cards__title {
  margin: 0;
  font-size: clamp(1.3rem, 2.2vw, 1.75rem);
  line-height: 1.15;
}

.cards--stack .cards__subtitle {
  margin: 0;
  color: var(--color-text-muted);
  font-size: 0.95rem;
}

.cards--stack .cards__stack {
  display: flex;
  flex-direction: row;
  gap: var(--stack-gap);
  list-style: none;
  margin: 0;
  padding: 0;
  overflow-x: auto;
  overflow-y: hidden;
  /* Occupa tutta l'altezza disponibile sotto l'header */
  height: 100%;
  min-height: 0;
  align-items: stretch;
}


.cards--stack .card {
  display: flex;
  flex-direction: column;
  gap: var(--stack-gap);
  border-radius: var(--card-radius);
  border: 1px solid var(--card-border);
  background: var(--card-bg);
  padding: var(--card-padding);
  box-shadow: none;
  flex: 0 0 auto;
  width: clamp(280px, 30vw, 350px);
  /* Le card si adattano all'altezza della sezione */
  height: 100%;
  overflow: hidden;
}

.cards--stack .card:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 2px color-mix(in srgb, var(--color-primary) 65%, transparent),
    0 0 0 5px color-mix(in srgb, var(--color-primary) 25%, transparent);
}

.cards--stack .card__header {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.cards--stack .card__overline {
  margin: 0;
  font-size: 0.82rem;
  color: var(--color-text-muted);
  letter-spacing: 0.04em;
  text-transform: uppercase;
}

.cards--stack .card__title {
  margin: 0;
  font-size: clamp(1.05rem, 1.9vw, 1.35rem);
  line-height: 1.25;
}

.cards--stack .card__media {
  border-radius: 0;
  overflow: hidden;
  aspect-ratio: var(--media-ratio);
  background: rgba(255, 255, 255, 0.04);
  /* Non far collassare la media: riserva spazio proporzionale */
  flex: 0 0 auto;
}

.cards--stack .card__img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 0 !important;
}

.cards--stack .card__body {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 0;
  flex: 1;
  min-height: 0;
}

.cards--stack .card__desc {
  margin: 0;
  color: var(--color-text);
  line-height: 1.6;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  line-clamp: 3;
  -webkit-box-orient: vertical;
  flex: 1;
}

.cards--stack .card__desc--primary {
  color: var(--color-primary);
  font-weight: 500;
}

.cards--stack .card__desc--accent {
  color: var(--color-accent);
  font-weight: 500;
}

.cards--stack .card__desc--centered {
  text-align: center;
}

.cards--stack .card__actions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

/* Smaller buttons in homepage cards to fit within height constraints */
.cards--stack .card__actions .btn,
.cards--stack .card__actions .pill {
  font-size: clamp(0.7rem, 1.5vw, 0.75rem);
  padding: var(--space-1-5) var(--space-3);
  gap: var(--space-1);
  letter-spacing: var(--tracking-wide);
}

.cards--stack .card__cta-row .btn,
.cards--stack .card__cta-row .pill {
  font-size: clamp(0.7rem, 1.5vw, 0.75rem);
  padding: var(--space-1-5) var(--space-3);
  gap: var(--space-1);
  letter-spacing: var(--tracking-wide);
}

@media (min-width: 1024px) {
  #cards.cards--stack.cards--panels .card:not(.is-expanded) .card__actions {
    display: none;
  }

  #cards.cards--stack.cards--panels .card.is-expanded .card__actions {
    display: flex;
  }
}

.cards--stack .card__btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  height: 32px;
  padding: 0 12px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--color-border-soft) 90%, transparent);
  background: transparent;
  color: inherit;
  text-decoration: none;
  font-weight: 600;
  transition: background 180ms ease, border-color 180ms ease;
}

/* Allow Decap-provided variants to render with base btn/pill visuals inside cards */
.cards--stack .card__actions .card__btn.pill,
.cards--stack .card__actions .card__btn.btn {
  height: auto;
  padding: var(--space-2-5) var(--space-5);
  border: 1px solid var(--btn-border);
  background: var(--btn-bg);
  color: var(--btn-color);
  box-shadow: var(--btn-shadow);
}

.cards--stack .card__btn:hover,
.cards--stack .card__btn:focus-visible {
  background: rgba(255, 255, 255, 0.06);
  border-color: rgba(255, 255, 255, 0.35);
}

/* Preserve button variant colors for card__btn combined with pill/btn classes */
.cards--stack .card__actions .card__btn.pill:hover,
.cards--stack .card__actions .card__btn.pill:focus-visible,
.cards--stack .card__actions .card__btn.btn:hover,
.cards--stack .card__actions .card__btn.btn:focus-visible,
.cards--stack .card__cta-row .card__cta.pill:hover,
.cards--stack .card__cta-row .card__cta.pill:focus-visible,
.cards--stack .card__cta-row .card__cta.btn:hover,
.cards--stack .card__cta-row .card__cta.btn:focus-visible {
  color: var(--btn-color) !important;
  background: var(--btn-bg) !important;
  border-color: var(--btn-border) !important;
}

.cards--stack .card__cta-row {
  display: flex;
  justify-content: flex-start;
}

.cards--stack .card__cta {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.45rem 1rem;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.28);
  text-decoration: none;
  font-weight: 600;
  color: inherit;
  transition: background 180ms ease, border-color 180ms ease;
}

/* Ensure primary CTA also honors Decap variants when present */
.cards--stack .card__cta-row .card__cta.pill,
.cards--stack .card__cta-row .card__cta.btn {
  border: 1px solid var(--btn-border);
  background: var(--btn-bg);
  color: var(--btn-color);
  box-shadow: var(--btn-shadow);
}

.cards--stack .card__cta:hover,
.cards--stack .card__cta:focus-visible {
  border-color: rgba(255, 255, 255, 0.55);
  background: rgba(255, 255, 255, 0.08);
}

@media (max-width: 768px) {
  .cards--stack {
    height: clamp(420px, 70vh, 720px);
  }

  .cards--stack .card {
    width: clamp(250px, 70vw, 300px);
  }

  .cards--stack .card__overline {
    font-size: 0.7rem;
  }
}

@media (min-width: 1024px) {
  .cards--stack {
    --stack-gap: clamp(14px, 1.8vw, 20px);
    --card-padding: clamp(16px, 1.6vw, 22px);
  }

  .cards--stack .card__title {
    font-size: clamp(1.15rem, 1.8vw, 1.45rem);
  }
}
/* === Panels 4x1 (desktop) / Carosello (mobile) === */
#cards.cards--stack.cards--panels {
  height: auto;
  position: relative;
  z-index: 0;

  .cards__inner {
    padding: 0;
  }

  .cards__stack {
    display: flex;
    flex-direction: row;
    gap: 0;
    align-items: stretch;
    height: 720px;
    overflow-x: hidden;
    overflow-y: hidden;
  }

  .card {
    position: relative;
    flex: 1 1 25%;
    min-width: 0;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    justify-content: flex-start;
    border-radius: 0;
    border: 1px solid rgba(8, 11, 22, 0.85);
    background: rgba(6, 10, 18, 0.45);
    overflow: hidden;
    isolation: isolate;
    box-sizing: border-box;
    padding: 0;
    gap: 0;
    transition:
      flex-basis var(--dur-anim) var(--ease-anim),
      filter var(--dur-anim) var(--ease-anim),
      border-color var(--dur-anim) var(--ease-anim),
      background var(--dur-anim) var(--ease-anim);
    cursor: pointer;
  }

  .card .card__media {
    margin: 0;
  }

  .card::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    mix-blend-mode: normal;
    opacity: 0;
    transition: opacity var(--dur-anim) var(--ease-anim);
    z-index: 1;
  }

  .card:nth-child(1)::before { background: linear-gradient(to bottom, var(--card-1), transparent); }
  .card:nth-child(2)::before { background: linear-gradient(to bottom, var(--card-2), transparent); }
  .card:nth-child(3)::before { background: linear-gradient(to bottom, var(--card-3), transparent); }
  .card:nth-child(4)::before { background: linear-gradient(to bottom, var(--card-4), transparent); }

  .card:not(.is-expanded)::before {
    opacity: 0.85;
  }

  .card__media {
    position: relative;
    width: 100%;
    aspect-ratio: 16 / 9;
    order: 1;
    z-index: 0;
    transition:
      transform var(--dur-anim) var(--ease-anim),
      height var(--dur-anim) var(--ease-anim),
      aspect-ratio var(--dur-anim) var(--ease-anim);
  }

  .card.is-expanded .card__media {
    max-height: 33.333%;
    height: 33.333%;
    aspect-ratio: 16 / 9;
  }

  .card__media,
  .card__img {
    width: 100%;
    height: 100%;
  }

  .card__img {
    object-fit: cover;
    display: block;
    border-radius: 0 !important;
  }

  /* Desktop override: when expanded, make media span full card width */
  @media (min-width: 1024px) {
    #cards.cards--stack.cards--panels .card.is-expanded .card__media {
      width: 100%;
      height: auto;
      max-height: none;
      aspect-ratio: 16 / 9;
    }
    #cards.cards--stack.cards--panels .card.is-expanded .card__img {
      width: 100%;
      height: auto;
      object-fit: cover;
    }
  }

  .card__header {
    order: 2;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    padding: 1.5rem 1.75rem;
    z-index: 2;
    writing-mode: horizontal-tb;
    text-orientation: mixed;
    text-align: left;
    background: rgba(5, 9, 16, 0.35);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    transition:
      background var(--dur-anim) var(--ease-anim),
      backdrop-filter var(--dur-anim) var(--ease-anim),
      padding var(--dur-anim) var(--ease-anim);
  }

  .card__title {
    font-family: "LexendDeca", var(--font-display);
    font-size: clamp(0.9rem, 1.4vw, 1.1rem);
    line-height: 1.3;
    letter-spacing: 0.01em;
  }

  .card__body {
    order: 3;
    position: relative;
    padding: 1rem 1.75rem 1.75rem;
    z-index: 2;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    flex: 1 1 auto;
    opacity: 1;
    transform: none;
    pointer-events: auto;
    overflow: visible;
    scrollbar-width: thin;
    transition:
      opacity var(--dur-anim) var(--ease-anim),
      transform var(--dur-anim) var(--ease-anim);
  }

  .card__body .card__desc {
    width: 100%;
    max-width: 100%;
    display: block;
  }

  .card__content {
    display: none;
    width: 100%;
    max-width: 100%;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--color-text);
    font-size: 0.95rem;
    line-height: 1.7;

    /* Buttons inside extended content: smaller, text-like rhythm */
    .btn,
    .pill {
      font-family: var(--font-sans);
      text-transform: none;
      letter-spacing: 0.01em;
      font-size: var(--text-sm);
      line-height: 1.4;
      gap: var(--space-1);
      padding: var(--space-1) var(--space-2-5);
      border-radius: var(--radius-full);
    }

    h2, h3 {
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      color: var(--color-primary);
    }

    h2 {
      font-size: 1.25rem;
    }

    h3 {
      font-size: 1.1rem;
    }

    p {
      margin-bottom: 0.75rem;
    }

    ul, ol {
      margin: 0.75rem 0;
      padding-left: 1.5rem;
    }

    li {
      margin-bottom: 0.5rem;
    }

    code {
      background: rgba(255, 255, 255, 0.05);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-size: 0.9em;
    }
  }

  .card.is-expanded .card__content {
    display: block;
  }

  /* Desktop: aggiungi scroll quando card è espansa */
  @media (min-width: 1024px) {
    .card.is-expanded .card__body {
      max-height: 50vh;
      overflow-y: auto;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }
  }

  .card__body::-webkit-scrollbar {
    width: 6px;
  }

  .card__body::-webkit-scrollbar-thumb {
    background: rgba(84, 104, 168, 0.45);
    border-radius: 999px;
  }

  .card:not(.is-expanded) {
    justify-content: flex-end;
  }

  .card:not(.is-expanded) .card__media {
    position: absolute;
    inset: 0;
    height: 100%;
    aspect-ratio: auto;
  }

  .card:not(.is-expanded) .card__header {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: clamp(3.5rem, 6vw, 5rem);
    padding: clamp(1rem, 2vw, 1.5rem) clamp(0.75rem, 1.2vw, 1rem);
    writing-mode: vertical-rl;
    text-orientation: upright;
    text-align: start;
    align-items: flex-start;
    justify-content: center;
    gap: 0.65rem;
    overflow: hidden;
    word-break: break-word;
    background: rgba(5, 9, 16, 0.35);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow: -2px 0 12px rgba(0, 0, 0, 0.3);
    transition:
      background var(--dur-anim) var(--ease-anim),
      backdrop-filter var(--dur-anim) var(--ease-anim),
      width var(--dur-anim) var(--ease-anim),
      padding var(--dur-anim) var(--ease-anim),
      writing-mode var(--dur-anim) var(--ease-anim);
  }

  .card:not(.is-expanded) .card__overline {
    text-shadow: none;
    font-size: clamp(0.65rem, 1vw, 0.75rem);
  }

  .card:not(.is-expanded) .card__title {
    text-shadow: none;
    font-size: clamp(0.75rem, 1.1vw, 0.85rem);
  }

  .card:not(.is-expanded) .card__body {
    position: absolute;
    inset-inline: 0;
    bottom: 0;
    padding: 1.15rem 1.4rem;
    opacity: 0;
    transform: translateY(12px);
    pointer-events: none;
    flex: none;
    overflow: hidden;
  }

  .card.is-expanded {
    flex-basis: 70%;
    filter: none;
    background: rgba(5, 9, 16, 0.88);
    border-color: rgba(20, 32, 54, 0.95);
    box-shadow: 0 0 40px rgba(10, 18, 36, 0.45);
  }

  .card.is-expanded .card__media {
    border-bottom: 1px solid rgba(8, 11, 22, 0.6);
  }

  .card.is-collapsed {
    flex-basis: 10%;
    filter: brightness(0.72) saturate(0.92);
  }

  /* Hover effect generale: evidenzia la card puntata e desatura le altre */
  @media (hover: hover) and (pointer: fine) and (min-width: 75rem) {
    .cards__stack {
      position: relative;
    }

    .cards__stack:hover .card {
      transition: filter 220ms ease, opacity 220ms ease, box-shadow 220ms ease;
    }

    .cards__stack:hover .card:not(:hover) {
      filter: grayscale(80%) saturate(0.65) brightness(0.7);
      opacity: 0.7;
    }

    .cards__stack:hover .card:hover {
      filter: none;
      opacity: 1;
      border-color: rgba(32, 54, 92, 0.95);
      box-shadow: 0 0 32px rgba(20, 40, 72, 0.45);
    }
  }

  &.cards--equal {
    .card {
      flex-basis: 25% !important;
      filter: none;
    }

    @media (hover: hover) and (pointer: fine) and (min-width: 75rem) {
      .cards__stack:hover .card:not(:hover) {
        filter: grayscale(80%) saturate(0.65) brightness(0.55);
        opacity: 0.55;
      }
    }
  }

  /* Mobile e Tablet: comportamento carousel fino a 1024px per evitare
     problemi di aspect-ratio e ridimensionamento immagini */
  @media (max-width: 1023px) {
    height: auto;
    min-height: 0;

    .cards__inner {
      padding-inline: 8px;
      padding-block: 0;
    }

    .cards__stack {
      position: relative;
      display: block;
      overflow: hidden;
      min-height: clamp(420px, 68vh, 560px);
      touch-action: pan-y;
      scroll-snap-type: none;
      -webkit-overflow-scrolling: auto;
      scroll-behavior: auto;
    }

    .card {
      /* Card usa flexbox column per distribuire gli elementi proporzionalmente */
      display: flex;
      flex-direction: column;
      flex: 1 1 auto;
      min-width: 100%;
      /* MOBILE/TABLET: Altezza adattiva basata su viewport */
      min-height: clamp(480px, 70vh, 640px);
      max-height: clamp(520px, 75vh, 680px);
      border-radius: var(--card-radius);
      background: rgba(5, 9, 16, 0.72);
      justify-content: flex-start;
      width: 100%;
      box-shadow: none;
      border: none;
      padding: 0;
      gap: 0;
      filter: none;
      position: absolute;
      inset: 0;
      --card-mobile-inline: clamp(1.1rem, 4.8vw, 1.6rem);
      --card-mobile-block: clamp(1.1rem, 4.2vw, 1.4rem);
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transform: translateX(6%) scale(0.96);
      cursor: default;
      z-index: 1;
      transition:
        opacity var(--dur-anim) var(--ease-anim),
        transform var(--dur-anim) var(--ease-anim);
    }

    .card.is-active {
      position: relative;
      opacity: 1;
      visibility: visible;
      pointer-events: none;
      transform: translateX(0) scale(1);
      z-index: 10;
    }

    .card.is-active a,
    .card.is-active button,
    .card.is-active .card__body {
      pointer-events: auto;
    }

    .card::before {
      opacity: 0;
      display: none;
    }

    .card .card__media,
    .card:not(.is-expanded) .card__media {
      position: relative;
      inset: auto;
      /* L'immagine cresce proporzionalmente basandosi sul 45% dell'altezza della card */
      flex: 0 0 45%;
      width: 100%;
      /* Mantiene aspect ratio 16/9 ma può crescere con la card */
      aspect-ratio: 16 / 9;
      border-radius: var(--card-radius) var(--card-radius) 0 0;
      overflow: hidden;
      margin: 0;
      border-bottom: none;
    }

    .card .card__img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    .card .card__header,
    .card:not(.is-expanded) .card__header {
      /* Header cresce solo quanto necessario per il contenuto */
      flex: 0 0 auto;
      width: 100%;
      max-width: 100%;
      position: relative;
      top: auto;
      inset: auto;
      transform: none;
      padding: var(--card-mobile-block) var(--card-mobile-inline) calc(var(--card-mobile-block) / 2);
      writing-mode: horizontal-tb !important;
      text-orientation: mixed !important;
      text-align: left;
      align-items: flex-start;
      justify-content: flex-start;
      gap: 0.5rem;
      max-height: none;
      overflow: visible;
      word-break: normal;
      background: transparent;
      box-shadow: none;
    }

    .card .card__overline,
    .card:not(.is-expanded) .card__overline {
      writing-mode: horizontal-tb !important;
      text-orientation: mixed !important;
      text-align: left !important;
      transform: none !important;
      width: 100% !important;
      max-width: 100% !important;
      font-size: 0.7rem !important;
      text-shadow: none !important;
      white-space: normal !important;
      overflow: visible !important;
    }

    .card .card__title,
    .card:not(.is-expanded) .card__title {
      writing-mode: horizontal-tb !important;
      text-orientation: mixed !important;
      text-align: left !important;
      transform: none !important;
      width: 100% !important;
      max-width: 100% !important;
      font-size: inherit !important;
      text-shadow: none !important;
      white-space: normal !important;
      /* Uniforma altezza titolo su mobile con clamp */
      --card-title-lines: 2;
      --card-title-lh: 1.3;
      line-height: var(--card-title-lh);
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: var(--card-title-lines);
      line-clamp: var(--card-title-lines);
      min-block-size: calc(var(--card-title-lines) * var(--card-title-lh) * 1em);
      overflow: hidden !important;
    }

    .card .card__body,
    .card:not(.is-expanded) .card__body {
      /* Il body occupa circa il 40% dell'altezza della card per crescere proporzionalmente */
      flex: 0 0 40%;
      width: 100%;
      max-width: 100%;
      position: relative;
      inset-inline: auto;
      bottom: auto;
      /* Tighter spacing between text and actions on mobile/tablet */
      padding: 0 var(--card-mobile-inline) calc(var(--card-mobile-block) / 4);
      gap: var(--space-1);
      opacity: 1;
      transform: none;
      pointer-events: auto;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
      isolation: isolate;
    }

    .card .card__desc {
      /* Mobile: clamp su ~400 caratteri */
      --card-desc-lh: 1.6;
      --card-desc-lines: 8;
      color: var(--color-text-soft);
      line-height: var(--card-desc-lh);
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: var(--card-desc-lines);
      line-clamp: var(--card-desc-lines);
      overflow: hidden;
      text-align: justify;
      flex: 1 1 auto;
      max-height: calc(var(--card-desc-lines) * var(--card-desc-lh) * 1em);
    }

    .card .card__content {
      display: none !important;
    }

    #cards.cards--stack.cards--panels .card .card__actions {
      opacity: 1;
      pointer-events: auto;
      /* MOBILE: Forza button in linea (max 2) */
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap; /* Non andare a capo */
      gap: 0.5rem;
      /* Reduce distance from text */
      margin-top: var(--space-1);
      padding: 0 var(--card-mobile-inline);
      padding-bottom: var(--card-mobile-block);
      overflow-x: auto; /* Scroll orizzontale se necessario */
      scrollbar-width: none; /* Nascondi scrollbar Firefox */
      -ms-overflow-style: none; /* Nascondi scrollbar IE/Edge */
    }

    /* Nascondi scrollbar Webkit */
    #cards.cards--stack.cards--panels .card .card__actions::-webkit-scrollbar {
      display: none;
    }

    .card .card__cta-row {
      /* MOBILE: Anche i CTA in linea per coerenza */
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      gap: 0.5rem;
      width: 100%;
      /* Reduce distance from text */
      margin-top: var(--space-1);
      padding: 0 var(--card-mobile-inline);
      padding-bottom: var(--card-mobile-block);
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .card .card__cta-row::-webkit-scrollbar {
      display: none;
    }

    .card .card__actions .card__btn,
    .card .card__cta-row .card__cta {
      /* MOBILE: Button con larghezza automatica per stare in linea */
      flex: 0 0 auto; /* Non crescere/ridursi */
      min-width: max-content; /* Larghezza basata sul contenuto */
      justify-content: center;
      white-space: nowrap; /* Testo su una riga */
    }

    /* Remove hover effects on all card links for mobile */
    .card .card__actions .card__btn:hover,
    .card .card__cta-row .card__cta:hover {
      background: transparent;
      border-color: rgba(255, 255, 255, 0.28);
      transform: none;
    }

    /* Preserve button color on hover for standard btn/pill classes on mobile */
    #cards.cards--stack.cards--panels .card .card__actions .btn:hover,
    #cards.cards--stack.cards--panels .card .card__actions .btn:focus-visible,
    #cards.cards--stack.cards--panels .card .card__actions .pill:hover,
    #cards.cards--stack.cards--panels .card .card__actions .pill:focus-visible,
    #cards.cards--stack.cards--panels .card .card__actions .card__btn.pill:hover,
    #cards.cards--stack.cards--panels .card .card__actions .card__btn.pill:focus-visible,
    #cards.cards--stack.cards--panels .card .card__actions .card__btn.btn:hover,
    #cards.cards--stack.cards--panels .card .card__actions .card__btn.btn:focus-visible,
    #cards.cards--stack.cards--panels .card .card__cta-row .btn:hover,
    #cards.cards--stack.cards--panels .card .card__cta-row .btn:focus-visible,
    #cards.cards--stack.cards--panels .card .card__cta-row .pill:hover,
    #cards.cards--stack.cards--panels .card .card__cta-row .pill:focus-visible,
    #cards.cards--stack.cards--panels .card .card__cta-row .card__cta.pill:hover,
    #cards.cards--stack.cards--panels .card .card__cta-row .card__cta.pill:focus-visible,
    #cards.cards--stack.cards--panels .card .card__cta-row .card__cta.btn:hover,
    #cards.cards--stack.cards--panels .card .card__cta-row .card__cta.btn:focus-visible {
      color: var(--btn-color) !important;
    }

    /* Ensure stacking order: media below, body above, play within media */
    .card .card__media { z-index: 1; }
    .card .card__header { z-index: 2; }
    .card .card__body { z-index: 3; }
    .card .card__play { z-index: 4; }

    .card.is-expanded,
    .card.is-collapsed {
      flex-basis: 100% !important;
      filter: none;
    }

    /* Tablet (viewport >600px): altezze maggiorate per sfruttare meglio lo spazio */
    @media (min-width: 600px) {
      .card {
        /* Su tablet, aumentiamo le altezze per una visualizzazione migliore */
        min-height: clamp(540px, 72vh, 720px);
        max-height: clamp(580px, 78vh, 780px);
      }

      .card .card__media,
      .card:not(.is-expanded) .card__media {
        /* Su tablet l'immagine occupa il 48% dell'altezza */
        flex: 0 0 48%;
      }

      .card .card__body,
      .card:not(.is-expanded) .card__body {
        /* Il body su tablet occupa il 38% per bilanciare */
        flex: 0 0 38%;
      }
    }

    &.cards--equal {
      .card {
        flex-basis: 100% !important;
      }
    }
  }

  .cards__pager {
    display: none;
  }

  /* Paginazione visibile fino a 1024px per supportare il carousel esteso */
  @media (max-width: 1023px) {
    .cards__pager {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem 8px 0.5rem;
      min-height: 2.5rem;
    }

    .cards__dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      border: none;
      padding: 0;
      margin: 0.25rem;
      background: rgba(148, 163, 210, 0.35);
      transition: transform 200ms ease, background-color 200ms ease, opacity 200ms ease;
      flex-shrink: 0;
    }

    .cards__dot:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 4px;
    }

    .cards__dot[aria-current="true"] {
      background: var(--color-primary);
      transform: scale(1.4);
      opacity: 1;
    }
  }
}

/* ==========================================
   IMAGE ROTATION - Homepage Cards
   CSS transform per ruotare immagini card
   Container: aspect-ratio 16/9 (1.78:1)
   ========================================== */

.card__img[data-rotation="90"] {
  /* Ruota e scala per riempire container 16:9 */
  transform: rotate(90deg) scale(1.78);
  transform-origin: center center;
}

.card__img[data-rotation="180"] {
  transform: rotate(180deg);
}

.card__img[data-rotation="270"] {
  /* Ruota e scala per riempire container 16:9 */
  transform: rotate(270deg) scale(1.78);
  transform-origin: center center;
}

/* Hover su immagini ruotate - mantiene la proporzione corretta */
.card:hover .card__img[data-rotation="90"] {
  transform: rotate(90deg) scale(1.87); /* 1.78 * 1.05 */
}

.card:hover .card__img[data-rotation="270"] {
  transform: rotate(270deg) scale(1.87); /* 1.78 * 1.05 */
}

.card:hover .card__img[data-rotation="180"] {
  transform: rotate(180deg) scale(1.05);
}

/* Transizione smooth */
.card__img[data-rotation] {
  transition: transform 0.3s ease;
}




