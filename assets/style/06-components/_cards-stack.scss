/* ========================================================================== 
   Cards Stack Variant
   ========================================================================== */

.cards--stack {
  --stack-gap: clamp(12px, 2vw, 18px);
  --card-radius: calc(var(--radius-xl, 18px) - 6px);
  --card-border: color-mix(in srgb, var(--color-border-soft) 80%, transparent);
  --card-bg: color-mix(in srgb, var(--color-surface-elevated, #111421) 85%, transparent 15%);
  --card-padding: clamp(14px, 2vw, 18px);
  --media-ratio: 3 / 4;
  /* Altezza esplicita della sezione per ancorare le card */
  height: clamp(700px, 75vh, 1000px);
  overflow: hidden;
}

.cards--stack .cards__inner {
  display: grid;
  gap: var(--stack-gap);
  /* Header + stack che occupa lo spazio rimanente */
  grid-template-rows: auto 1fr;
  height: 100%;
}

.cards--stack .cards__header {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.cards--stack .cards__intro {
  display: grid;
  gap: 0.35rem;
}

.cards--stack .cards__eyebrow {
  font-size: 0.85rem;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.cards--stack .cards__title {
  margin: 0;
  font-size: clamp(1.3rem, 2.2vw, 1.75rem);
  line-height: 1.15;
}

.cards--stack .cards__subtitle {
  margin: 0;
  color: var(--color-text-muted);
  font-size: 0.95rem;
}

.cards--stack .cards__stack {
  display: flex;
  flex-direction: row;
  gap: var(--stack-gap);
  list-style: none;
  margin: 0;
  padding: 0;
  overflow-x: auto;
  overflow-y: hidden;
  /* Occupa tutta l'altezza disponibile sotto l'header */
  height: 100%;
  min-height: 0;
  align-items: stretch;
}


.cards--stack .card {
  display: flex;
  flex-direction: column;
  gap: 0; /* REMOVED gap - no spacing between card children */
  border-radius: var(--card-radius);
  border: 1px solid var(--card-border);
  background: var(--card-bg);
  padding: 0; /* REMOVED padding - causing spacing on mobile */
  box-shadow: none;
  flex: 0 0 auto;
  width: clamp(280px, 30vw, 350px);
  /* Le card si adattano all'altezza della sezione */
  height: 100%;
  overflow: hidden;
}

.cards--stack .card:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 2px color-mix(in srgb, var(--color-primary) 65%, transparent),
    0 0 0 5px color-mix(in srgb, var(--color-primary) 25%, transparent);
}

.cards--stack .card__header {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.cards--stack .card__overline {
  margin: 0;
  font-size: 0.82rem;
  color: var(--color-text-muted);
  letter-spacing: 0.04em;
  text-transform: uppercase;
}

.cards--stack .card__title {
  margin: 0;
  font-size: clamp(1.05rem, 1.9vw, 1.35rem);
  line-height: 1.25;
}

.cards--stack .card__media {
  border-radius: 0;
  overflow: hidden;
  aspect-ratio: var(--media-ratio);
  background: rgba(255, 255, 255, 0.04);
  /* Non far collassare la media: riserva spazio proporzionale */
  flex: 0 0 auto;
}

.cards--stack .card__img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 0; /* Specificity 0,2,0 sufficient - no conflicting rule found */
}

.cards--stack .card__body {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 0;
  flex: 1;
  min-height: 0;
}

.cards--stack .card__desc {
  margin: 0;
  color: var(--color-text);
  line-height: 1.6;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  line-clamp: 3;
  -webkit-box-orient: vertical;
  flex: 1;
}

.cards--stack .card__desc--primary {
  color: var(--color-primary);
  font-weight: 500;
}

.cards--stack .card__desc--accent {
  color: var(--color-accent);
  font-weight: 500;
}

.cards--stack .card__desc--centered {
  text-align: center;
}

.cards--stack .card__actions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

/* Smaller buttons in homepage cards to fit within height constraints */
.cards--stack .card__actions .btn,
.cards--stack .card__actions .pill {
  font-size: clamp(0.7rem, 1.5vw, 0.75rem);
  padding: var(--space-1-5) var(--space-3);
  gap: var(--space-1);
  letter-spacing: var(--tracking-wide);
}

.cards--stack .card__cta-row .btn,
.cards--stack .card__cta-row .pill {
  font-size: clamp(0.7rem, 1.5vw, 0.75rem);
  padding: var(--space-1-5) var(--space-3);
  gap: var(--space-1);
  letter-spacing: var(--tracking-wide);
}

@media (min-width: 1024px) {
  #cards.cards--stack.cards--panels .card:not(.is-expanded) .card__actions {
    display: none;
  }

  #cards.cards--stack.cards--panels .card.is-expanded .card__actions {
    display: flex;
  }
}

.cards--stack .card__btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  height: 32px;
  padding: 0 12px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--color-border-soft) 90%, transparent);
  background: transparent;
  color: inherit;
  text-decoration: none;
  font-weight: 600;
  transition: background 180ms ease, border-color 180ms ease;
}

/* Allow Decap-provided variants to render with base btn/pill visuals inside cards */
.cards--stack .card__actions .card__btn.pill,
.cards--stack .card__actions .card__btn.btn {
  height: auto;
  padding: var(--space-2-5) var(--space-5);
  border: 1px solid var(--btn-border);
  background: var(--btn-bg);
  color: var(--btn-color);
  box-shadow: var(--btn-shadow);
}

.cards--stack .card__btn:hover,
.cards--stack .card__btn:focus-visible {
  background: rgba(255, 255, 255, 0.06);
  border-color: rgba(255, 255, 255, 0.35);
}

/* Preserve button variant colors for card__btn combined with pill/btn classes */
/* Specificity 0,5,1 wins over base .pill:hover (0,2,0) naturally */
.cards--stack .card__actions .card__btn.pill:hover,
.cards--stack .card__actions .card__btn.pill:focus-visible,
.cards--stack .card__actions .card__btn.btn:hover,
.cards--stack .card__actions .card__btn.btn:focus-visible,
.cards--stack .card__cta-row .card__cta.pill:hover,
.cards--stack .card__cta-row .card__cta.pill:focus-visible,
.cards--stack .card__cta-row .card__cta.btn:hover,
.cards--stack .card__cta-row .card__cta.btn:focus-visible {
  color: var(--btn-color);
  background: var(--btn-bg);
  border-color: var(--btn-border);
}

.cards--stack .card__cta-row {
  display: flex;
  justify-content: flex-start;
}

.cards--stack .card__cta {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.45rem 1rem;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.28);
  text-decoration: none;
  font-weight: 600;
  color: inherit;
  transition: background 180ms ease, border-color 180ms ease;
}

/* Ensure primary CTA also honors Decap variants when present */
.cards--stack .card__cta-row .card__cta.pill,
.cards--stack .card__cta-row .card__cta.btn {
  border: 1px solid var(--btn-border);
  background: var(--btn-bg);
  color: var(--btn-color);
  box-shadow: var(--btn-shadow);
}

.cards--stack .card__cta:hover,
.cards--stack .card__cta:focus-visible {
  border-color: rgba(255, 255, 255, 0.55);
  background: rgba(255, 255, 255, 0.08);
}

@media (max-width: 767.98px) {
  .cards--stack {
    height: clamp(420px, 70vh, 720px);
  }

  .cards--stack .card {
    width: clamp(250px, 70vw, 300px);
  }

  .cards--stack .card__overline {
    font-size: 0.7rem;
  }
}

/* Mobile override: avoid aspect-ratio conflicts on panels */
@media (max-width: 1023px) {
  #cards.cards--stack.cards--panels .card .card__media {
    aspect-ratio: auto;
  }
}

  @media (min-width: 1024px) {
    .cards--stack {
      --stack-gap: clamp(14px, 1.8vw, 20px);
      --card-padding: clamp(16px, 1.6vw, 22px);
    }

    .cards--stack .card__title {
    font-size: clamp(1.15rem, 1.8vw, 1.45rem);
  }
}
/* === Panels 4x1 (desktop) / Carosello (mobile) === */
#cards.cards--stack.cards--panels {
  height: auto;
  position: relative;
  z-index: 0;

  .cards__inner {
    padding: 0;
  }

  .cards__stack {
    display: flex;
    flex-direction: row;
    gap: 0;
    align-items: stretch;
    height: 720px;
    overflow-x: hidden;
    overflow-y: hidden;
  }

  .card {
    position: relative;
    flex: 1 1 25%;
    min-width: 0;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    justify-content: flex-start;
    border-radius: 0;
    border: 1px solid rgba(8, 11, 22, 0.85);
    background: rgba(6, 10, 18, 0.45);
    overflow: hidden;
    isolation: isolate;
    box-sizing: border-box;
    padding: 0;
    gap: 0;
    transition:
      flex-basis var(--dur-anim) var(--ease-anim),
      filter var(--dur-anim) var(--ease-anim),
      border-color var(--dur-anim) var(--ease-anim),
      background var(--dur-anim) var(--ease-anim);
    cursor: pointer;
  }

  .card .card__media {
    margin: 0;
  }

  .card::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    mix-blend-mode: normal;
    opacity: 0;
    transition: opacity var(--dur-anim) var(--ease-anim);
    z-index: 1;
  }

  .card:nth-child(1)::before { background: linear-gradient(to bottom, var(--card-1), transparent); }
  .card:nth-child(2)::before { background: linear-gradient(to bottom, var(--card-2), transparent); }
  .card:nth-child(3)::before { background: linear-gradient(to bottom, var(--card-3), transparent); }
  .card:nth-child(4)::before { background: linear-gradient(to bottom, var(--card-4), transparent); }

  .card:not(.is-expanded)::before {
    opacity: 0.85;
  }

  .card__media {
    position: relative;
    width: 100%;
    aspect-ratio: 16 / 9;
    order: 1;
    z-index: 0;
    transition:
      transform var(--dur-anim) var(--ease-anim),
      height var(--dur-anim) var(--ease-anim),
      aspect-ratio var(--dur-anim) var(--ease-anim);
  }

  .card.is-expanded .card__media {
    max-height: 33.333%;
    height: 33.333%;
    aspect-ratio: 16 / 9;
  }

  .card__media,
  .card__img {
    width: 100%;
    height: 100%;
  }

  .card__img {
    object-fit: cover;
    display: block;
    border-radius: 0; /* Within panels context, specificity 0,2,0 sufficient */
  }

  /* Desktop override: when expanded, media fills 1/3 of card height with 16:9 ratio */
  @media (min-width: 1024px) {
    .card.is-expanded .card__media {
      width: 100%;
      height: 33.333%;
      max-height: 33.333%;
      flex: 0 0 33.333%;
      aspect-ratio: 16 / 9;
    }
    /* Only apply to cards WITHOUT background image - otherwise image is used as full card background */
    .card.is-expanded:not([data-bg-url]) .card__img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  .card__header {
    order: 2;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    padding: 1.5rem 1.75rem;
    z-index: 2;
    writing-mode: horizontal-tb;
    text-orientation: mixed;
    text-align: left;
    background: rgba(5, 9, 16, 0.35);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    transition:
      background var(--dur-anim) var(--ease-anim),
      backdrop-filter var(--dur-anim) var(--ease-anim),
      padding var(--dur-anim) var(--ease-anim);
  }

  .card__title {
    font-family: "LexendDeca", var(--font-display);
    font-size: clamp(0.9rem, 1.4vw, 1.1rem);
    line-height: 1.3;
    letter-spacing: 0.01em;
  }

  .card__body {
    order: 3;
    position: relative;
    padding: 1rem 1.75rem 1.75rem;
    z-index: 2;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    flex: 1 1 auto;
    opacity: 1;
    transform: none;
    pointer-events: auto;
    overflow: visible;
    scrollbar-width: thin;
    transition:
      opacity var(--dur-anim) var(--ease-anim),
      transform var(--dur-anim) var(--ease-anim);
  }

  .card__body .card__desc {
    width: 100%;
    max-width: 100%;
    display: block;
  }

  .card__content {
    display: none;
    width: 100%;
    max-width: 100%;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--color-text);
    font-size: 0.95rem;
    line-height: 1.7;

    /* Buttons inside extended content: smaller, text-like rhythm */
    .btn,
    .pill {
      font-family: var(--font-sans);
      text-transform: none;
      letter-spacing: 0.01em;
      font-size: var(--text-sm);
      line-height: 1.4;
      gap: var(--space-1);
      padding: var(--space-1) var(--space-2-5);
      border-radius: var(--radius-full);
    }

    h2, h3 {
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      color: var(--color-primary);
    }

    h2 {
      font-size: 1.25rem;
    }

    h3 {
      font-size: 1.1rem;
    }

    p {
      margin-bottom: 0.75rem;
    }

    ul, ol {
      margin: 0.75rem 0;
      padding-left: 1.5rem;
    }

    li {
      margin-bottom: 0.5rem;
    }

    code {
      background: rgba(255, 255, 255, 0.05);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-size: 0.9em;
    }
  }

  .card.is-expanded .card__content {
    display: block;
  }

  /* Desktop: aggiungi scroll quando card è espansa */
  @media (min-width: 1024px) {
    .card.is-expanded .card__body {
      max-height: 50vh;
      overflow-y: auto;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }
  }

  .card__body::-webkit-scrollbar {
    width: 6px;
  }

  .card__body::-webkit-scrollbar-thumb {
    background: rgba(84, 104, 168, 0.45);
    border-radius: 999px;
  }

  .card:not(.is-expanded) {
    justify-content: flex-end;
  }

  .card:not(.is-expanded) .card__media {
    position: absolute;
    inset: 0;
    height: 100%;
    aspect-ratio: auto;
  }

  .card:not(.is-expanded) .card__header {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: clamp(3.5rem, 6vw, 5rem);
    padding: clamp(1rem, 2vw, 1.5rem) clamp(0.75rem, 1.2vw, 1rem);
    writing-mode: vertical-rl;
    text-orientation: upright;
    text-align: start;
    align-items: flex-start;
    justify-content: center;
    gap: 0.65rem;
    overflow: hidden;
    word-break: break-word;
    background: rgba(5, 9, 16, 0.35);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow: -2px 0 12px rgba(0, 0, 0, 0.3);
    transition:
      background var(--dur-anim) var(--ease-anim),
      backdrop-filter var(--dur-anim) var(--ease-anim),
      width var(--dur-anim) var(--ease-anim),
      padding var(--dur-anim) var(--ease-anim),
      writing-mode var(--dur-anim) var(--ease-anim);
  }

  .card:not(.is-expanded) .card__overline {
    text-shadow: none;
    font-size: clamp(0.65rem, 1vw, 0.75rem);
  }

  .card:not(.is-expanded) .card__title {
    text-shadow: none;
    font-size: clamp(0.75rem, 1.1vw, 0.85rem);
  }

  .card:not(.is-expanded) .card__body {
    position: absolute;
    inset-inline: 0;
    bottom: 0;
    padding: 1.15rem 1.4rem;
    opacity: 0;
    transform: translateY(12px);
    pointer-events: none;
    flex: none;
    overflow: hidden;
  }

  .card.is-expanded {
    flex-basis: 70%;
    filter: none;
    /* Use background-color instead of shorthand to preserve any background-image set on the card */
    background-color: rgba(5, 9, 16, 0.88);
    border-color: rgba(20, 32, 54, 0.95);
    box-shadow: 0 0 40px rgba(10, 18, 36, 0.45);
  }

  /* Desktop: when a panel card is expanded, use the card image as full background
     while keeping the entire layout (media box, play button, header, body) unchanged */
  @media (min-width: 1024px) {
    /* Paint the full-card background via ::before so it sits under all content
       without altering layout of header/body/media. */
    .card.is-expanded[data-bg-url]::before {
      content: "";
      display: block; /* override panels rule that hides ::before */
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: -1; /* keep behind all content including media box */
      opacity: 1;
      background-image:
        linear-gradient(180deg,
          rgba(7, 14, 26, 0.25) 0%,
          rgba(7, 14, 26, 0.80) 60%,
          rgba(7, 14, 26, 0.92) 100%
        ),
        var(--card-bg-image);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
    /* Make media area transparent so the card background shows through,
       but keep its layout dimensions and structure intact */
    .card.is-expanded[data-bg-url] .card__media {
      background: transparent;
    }
    .card.is-expanded[data-bg-url] .card__img {
      /* Hide the inline image completely to avoid duplication with background */
      display: none !important;
    }
    /* Keep the media overlay visible for play button contrast */
    .card.is-expanded[data-bg-url] .card__media-overlay {
      opacity: 0.4;
    }
  }

  .card.is-expanded .card__media {
    border-bottom: 1px solid rgba(8, 11, 22, 0.6);
  }

  .card.is-collapsed {
    flex-basis: 10%;
    filter: brightness(0.72) saturate(0.92);
  }

  /* Hover effect generale: evidenzia la card puntata e desatura le altre */
  @media (hover: hover) and (pointer: fine) and (min-width: 75rem) {
    .cards__stack {
      position: relative;
    }

    .cards__stack:hover .card {
      transition: filter 220ms ease, opacity 220ms ease, box-shadow 220ms ease;
    }

    .cards__stack:hover .card:not(:hover) {
      filter: grayscale(80%) saturate(0.65) brightness(0.7);
      opacity: 0.7;
    }

    .cards__stack:hover .card:hover {
      filter: none;
      opacity: 1;
      border-color: rgba(32, 54, 92, 0.95);
      box-shadow: 0 0 32px rgba(20, 40, 72, 0.45);
    }
  }

  &.cards--equal {
    .card {
      flex-basis: 25% !important;
      filter: none;
    }

    @media (hover: hover) and (pointer: fine) and (min-width: 75rem) {
      .cards__stack:hover .card:not(:hover) {
        filter: grayscale(80%) saturate(0.65) brightness(0.55);
        opacity: 0.55;
      }
    }
  }

  /* Mobile e Tablet: comportamento carousel fino a 1024px per evitare
     problemi di aspect-ratio e ridimensionamento immagini */
  @media (max-width: 1023px) {
    height: auto;
    min-height: 0;

    .cards__inner {
      padding-inline: 8px;
      padding-block: 0;
    }

    .cards__stack {
      position: relative;
      display: block;
      overflow: hidden;
      min-height: clamp(420px, 62vh, 540px);
      touch-action: pan-y;
      scroll-snap-type: none;
      -webkit-overflow-scrolling: auto;
      scroll-behavior: auto;
    }

    .card {
      /* Card usa flexbox column per distribuire gli elementi proporzionalmente */
      display: flex;
      flex-direction: column;
      flex: 1 1 auto;
      min-width: 100%;
      /* MOBILE/TABLET: Altezza adattiva basata su viewport (ridotta per card più compatta) */
      min-height: clamp(420px, 62vh, 540px);
      max-height: clamp(460px, 68vh, 600px);
      border-radius: var(--card-radius);
      background: rgba(5, 9, 16, 0.72);
      justify-content: flex-start;
      width: 100%;
      box-shadow: none;
      border: none;
      padding: 0;
      gap: 0;
      filter: none;
      position: absolute;
      inset: 0;
      overflow: hidden; /* Ensure border-radius clips children properly */
      --card-mobile-inline: clamp(1.1rem, 4.8vw, 1.6rem);
      --card-mobile-block: clamp(1.1rem, 4.2vw, 1.4rem);
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transform: translateX(6%) scale(0.96);
      cursor: default;
      z-index: 1;
      transition:
        opacity var(--dur-anim) var(--ease-anim),
        transform var(--dur-anim) var(--ease-anim);
    }

    .card.is-active {
      position: relative;
      opacity: 1;
      visibility: visible;
      pointer-events: none;
      transform: translateX(0) scale(1);
      z-index: 10;
    }

    .card.is-active a,
    .card.is-active button,
    .card.is-active .card__body {
      pointer-events: auto;
    }

    .card::before {
      opacity: 0;
      display: none;
    }

    /* On mobile, disable background-image on cards - use only the img tag */
    .card.has-bg-image[data-bg-url] {
      background-image: none !important;
    }

    .card .card__media,
    .card:not(.is-expanded) .card__media {
      position: relative;
      inset: auto;
      /* L'immagine cresce proporzionalmente basandosi sul 33% dell'altezza della card */
      flex: 0 0 33%;
      width: 100%;
      /* Mantiene aspect ratio 16/9 ma può crescere con la card */
      aspect-ratio: 16 / 9;
      margin: 0;
      border-bottom: none;
      /* Force media to appear first, before header (which comes first in HTML) */
      order: -1;
    }

    .card .card__img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center; /* Centra l'immagine nel container per evitare gap visivi */
      display: block; /* Elimina spazio extra causato da line-height */
    }

    /* Specificity 1,5,0 matches desktop (via parent #cards block), cascade order wins */
    .card:not(.is-collapsed) .card__header,
    .card.is-active .card__header {
      /* Header cresce solo quanto necessario per il contenuto */
      flex: 0 0 auto;
      width: 100%;
      max-width: 100%;
      position: relative;
      top: auto;
      inset: auto;
      transform: none;
      padding: var(--card-mobile-block) var(--card-mobile-inline) 0;
      writing-mode: horizontal-tb;
      text-orientation: mixed;
      text-align: left;
      align-items: flex-start;
      justify-content: flex-start;
      gap: 0.5rem;
      max-height: none;
      overflow: visible;
      word-break: normal;
      background: transparent;
      box-shadow: none;
    }

    /* Specificity 1,5,0 matches desktop (via parent #cards block), cascade order wins */
    .card:not(.is-collapsed) .card__overline,
    .card.is-active .card__overline {
      writing-mode: horizontal-tb;
      text-orientation: mixed;
      text-align: left;
      transform: none;
      width: 100%;
      max-width: 100%;
      font-size: 0.7rem;
      text-shadow: none;
      white-space: normal;
      overflow: visible;
    }

    /* Specificity 1,5,0 matches desktop (via parent #cards block), cascade order wins */
    .card:not(.is-collapsed) .card__title,
    .card.is-active .card__title {
      writing-mode: horizontal-tb;
      text-orientation: mixed;
      text-align: left;
      transform: none;
      width: 100%;
      max-width: 100%;
      font-size: inherit;
      text-shadow: none;
      white-space: normal;
      /* Uniforma altezza titolo su mobile con clamp */
      --card-title-lines: 2;
      --card-title-lh: 1.3;
      line-height: var(--card-title-lh);
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: var(--card-title-lines);
      line-clamp: var(--card-title-lines);
      min-block-size: calc(var(--card-title-lines) * var(--card-title-lh) * 1em);
      overflow: hidden;
    }

    .card .card__body,
    .card:not(.is-expanded) .card__body {
      /* Il body occupa circa il 45% dell'altezza della card (aumentato per compensare media ridotto) */
      flex: 0 0 45%;
      width: 100%;
      max-width: 100%;
      position: relative;
      inset-inline: auto;
      bottom: auto;
      /* Tighter spacing between text and actions on mobile/tablet */
      padding: 0 var(--card-mobile-inline) calc(var(--card-mobile-block) / 4);
      gap: var(--space-1);
      opacity: 1;
      transform: none;
      pointer-events: auto;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
      isolation: isolate;
    }

    .card .card__desc {
      /* Mobile: clamp su ~400 caratteri */
      --card-desc-lh: 1.6;
      --card-desc-lines: 8;
      color: var(--color-text-soft);
      line-height: var(--card-desc-lh);
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: var(--card-desc-lines);
      line-clamp: var(--card-desc-lines);
      overflow: hidden;
      text-align: justify;
      flex: 1 1 auto;
      max-height: calc(var(--card-desc-lines) * var(--card-desc-lh) * 1em);
    }

    /* Specificity 1,3,0 wins over desktop .card.is-expanded .card__content (1,3,0) via cascade */
    .card .card__content {
      display: none;
    }

    .card .card__actions {
      opacity: 1;
      pointer-events: auto;
      /* MOBILE: Forza button in linea (max 2) */
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap; /* Non andare a capo */
      gap: 0.5rem;
      /* Reduce distance from text */
      margin-top: var(--space-1);
      padding: 0 var(--card-mobile-inline);
      padding-bottom: var(--card-mobile-block);
      overflow-x: auto; /* Scroll orizzontale se necessario */
      scrollbar-width: none; /* Nascondi scrollbar Firefox */
      -ms-overflow-style: none; /* Nascondi scrollbar IE/Edge */
    }

    /* Nascondi scrollbar Webkit */
    .card .card__actions::-webkit-scrollbar {
      display: none;
    }

    .card .card__cta-row {
      /* MOBILE: Anche i CTA in linea per coerenza */
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      gap: 0.5rem;
      width: 100%;
      /* Reduce distance from text */
      margin-top: var(--space-1);
      padding: 0 var(--card-mobile-inline);
      padding-bottom: var(--card-mobile-block);
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .card .card__cta-row::-webkit-scrollbar {
      display: none;
    }

    .card .card__actions .card__btn,
    .card .card__cta-row .card__cta {
      /* MOBILE: Button con larghezza automatica per stare in linea */
      flex: 0 0 auto; /* Non crescere/ridursi */
      min-width: max-content; /* Larghezza basata sul contenuto */
      justify-content: center;
      white-space: nowrap; /* Testo su una riga */
    }

    /* Remove hover effects on all card links for mobile */
    .card .card__actions .card__btn:hover,
    .card .card__cta-row .card__cta:hover {
      background: transparent;
      border-color: rgba(255, 255, 255, 0.28);
      transform: none;
    }

    /* Preserve button color on hover for standard btn/pill classes on mobile */
    .card .card__actions .btn:hover,
    .card .card__actions .btn:focus-visible,
    .card .card__actions .pill:hover,
    .card .card__actions .pill:focus-visible,
    .card .card__actions .card__btn.pill:hover,
    .card .card__actions .card__btn.pill:focus-visible,
    .card .card__actions .card__btn.btn:hover,
    .card .card__actions .card__btn.btn:focus-visible,
    .card .card__cta-row .btn:hover,
    .card .card__cta-row .btn:focus-visible,
    .card .card__cta-row .pill:hover,
    .card .card__cta-row .pill:focus-visible,
    .card .card__cta-row .card__cta.pill:hover,
    .card .card__cta-row .card__cta.pill:focus-visible,
    .card .card__cta-row .card__cta.btn:hover,
    .card .card__cta-row .card__cta.btn:focus-visible {
      color: var(--btn-color);
      background: var(--btn-bg);
      border-color: var(--btn-border);
    }

    /* Ensure stacking order: media below, body above, play within media */
    .card .card__media { z-index: 1; }
    .card .card__header { z-index: 2; }
    .card .card__body { z-index: 3; }
    .card .card__play { z-index: 4; }

    /* Specificity 1,4,0 wins over desktop .card.is-expanded (1,2,0) via cascade */
    .card.is-expanded,
    .card.is-collapsed {
      flex-basis: 100%;
      filter: none;
    }

    /* Tablet (viewport >600px): altezze ridotte per card più compatta */
    @media (min-width: 600px) {
      .card {
        /* Su tablet, card più compatta mantenendo proporzioni */
        min-height: clamp(480px, 65vh, 620px);
        max-height: clamp(520px, 70vh, 660px);
      }

      .card .card__media,
      .card:not(.is-expanded) .card__media {
        /* Su tablet l'immagine occupa il 35% dell'altezza */
        flex: 0 0 35%;
      }

      .card .card__body,
      .card:not(.is-expanded) .card__body {
        /* Il body su tablet occupa il 43% per bilanciare (più spazio per testo) */
        flex: 0 0 43%;
      }
    }

    &.cards--equal {
      .card {
        flex-basis: 100% !important;
      }
    }
  }

  .cards__pager {
    display: none;
  }

  /* Paginazione visibile fino a 1024px per supportare il carousel esteso */
@media (max-width: 1023px) {
  .cards__pager {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem 8px 0.5rem;
      min-height: 2.5rem;
    }

    .cards__dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      border: none;
      padding: 0;
      margin: 0.25rem;
      background: rgba(148, 163, 210, 0.35);
      transition: transform 200ms ease, background-color 200ms ease, opacity 200ms ease;
      flex-shrink: 0;
    }

    .cards__dot:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 4px;
    }

    .cards__dot[aria-current="true"] {
      background: var(--color-primary);
      transform: scale(1.4);
      opacity: 1;
    }
  }
}





/* Stronger mobile fix: ensure media fills the top without ratio/flex conflicts */
@media (max-width: 1023px) {
  #cards.cards--stack.cards--panels .card .card__media,
  #cards.cards--stack.cards--panels .card:not(.is-expanded) .card__media {
    aspect-ratio: auto;
    height: 33%;
    flex: 0 0 33%; /* Mantiene consistenza con line 800, evita conflitti flex-basis */
  }
}

/* Mobile absolute image: ensure the media image fills its container */
@media (max-width: 1023px) {
  #cards.cards--stack.cards--panels .card .card__media {
    position: relative;
    overflow: hidden;
    /* Complete box model reset to eliminate phantom spacing above images.
       !important flags ensure this overrides any inherited or conflicting rules from:
       - UA default figure margins, - Base .card__media rules, - Desktop panel styles.
       Combined with flex: 0 0 33% (line 1097) and header padding: 0 (line 829). */
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
    top: 0;
    align-self: stretch; /* Ensures full width within flex container */
    line-height: 0; /* Eliminates inline/baseline gaps from text flow */
  }
  #cards.cards--stack.cards--panels .card .card__img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    max-width: none;  /* evita vincoli intrinseci che alterano il riempimento */
    max-height: none; /* impedisce scaling che lascia bande */
    vertical-align: top; /* elimina eventuali gap di baseline negli UA */
    object-fit: cover;
    object-position: center;
    display: block;
  }
}

